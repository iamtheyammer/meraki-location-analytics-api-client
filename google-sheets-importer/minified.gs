function onOpen(e){SpreadsheetApp.getUi();SpreadsheetApp.getUi().createAddonMenu().addItem("Get data","getCMXData").addToUi()}function getCMXData(){var e=getUserInfo(),t=apiCall(e.getUrl+"?secret="+e.secret+"&timespan="+e.timespan),a=[],n=SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Results").activate();n.clear(),n.getRange("A1:M1").setValues([["ID","Observing AP's MAC","Client's MAC","IPv4 (if connected)","IPv6 (if connected)","Time of observation","SSID (if connected)","RSSI","MAC Manufacturer","OS","Latitude","Longitude","Location uncertainty (metres)"]]);for(var s=0;s<t.jsonResponse.length;s++){data=t.jsonResponse[s];var o=new Date(0);o.setUTCSeconds(data.seenEpoch),a.push([data.id,data.apMac,data.clientMac,data.ipv4,data.ipv6,o,data.ssid,data.rssi,data.manufacturer,data.os,data.lat,data.lng,data.unc])}Logger.log(a),n.getRange(2,1,t.jsonResponse.length,13).setValues(a)}function apiCall(e){Logger.log("Attempting an API call to "+e+".");var t=UrlFetchApp.fetch(e,{contentType:"application/json",method:"GET"});Logger.log("API call succeeded. Parsing responses.");var a=t.getContentText(),n=JSON.parse(a);return Logger.log("Completed API call to "+e+"."),{jsonResponse:n,stringResponse:a}}function getUserInfo(){var e=SpreadsheetApp.getActiveSpreadsheet().getSheetByName("User data");return{getUrl:e.getRange("A2").getDisplayValue(),secret:e.getRange("B2").getDisplayValue(),timespan:e.getRange("C2").getDisplayValue()}}